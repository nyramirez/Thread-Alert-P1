<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Clock-in</title>
    <link rel="stylesheet" href="assets/demo.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Materialize CSS CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.css">
    <!-- bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">

    <script src="../build/tracking-min.js"></script>
    <script src="../build/data/face-min.js"></script>
    <script src="../node_modules/dat.gui/build/dat.gui.min.js"></script>
    <script src="assets/stats.min.js"></script>

    <style>
        video,
        canvas {
            margin-left: 230px;
            margin-top: 120px;
            position: absolute;
        }
    </style>
</head>

<body>

    <div class="demo-frame p-0">
        <div class="demo-container">
            <div id="panel">
                <div class="welcome py-4">
                    <h1 class="center-align">Welcome to NA2RS</h1>
                </div>
                <!-- Dialog Box-->
                <div class="modal" id="myform">
                    <form id=empID>
                        <label id="valueFromMyButton">
                        </label>
                        <input align=center id="input_text" type="text" id="name" data-length="3" maxlength="3" placeholder="ENTER EMPLOYEE ID" required>
                        <div align="center">
                            <input type="button" value="OK" id="btnOK">
                        </div>
                    </form>
                </div>
            </div>
            <video id="video" width="320" height="240" preload autoplay loop muted></video>
            <canvas id="canvas" width="320" height="240"></canvas>
        </div>
    </div>

    <script>

        window.onload = function () {

            function display() {
               $("#myform input[type=text]").val('');
               $("#valueFromMyModal").val('');
                $("#myform").show(500);
            }

            display();

            $("#btnOK").click(function () {
                var employeeID= $("#input_text").val().trim();
                $("#valueFromMyModal").val($("#myform input[type=text]").val().trim());
                console.log(employeeID);
                $("#myform").hide(400);
                canvas.toBlob(function (blob) {
                    name = Date.now() + '.png';
                    file = new File([blob], name, { type: 'image/png' });
                    console.log(file);
                    var timeStamp = file.lastModifiedDate;
                    var photo = file.name;
                    $("#cavas").append("url", file.name);

                    timeSpace.html(`<h5 class=mx-auto>Time: ${timeStamp}</h5>`);
                    $(".demo-frame").append(timeSpace);
                    clockInMsg.html(`<h3 class='center-align'>You are now clocked-in.<br>Have a great day at work!`);
                    $(".welcome").append(clockInMsg);

                    var queryURL = "https://api-us.faceplusplus.com/facepp/v3/detect";
                    var API_KEY = "cKYAUp9G8wVG1XId1bmDMSGFD5wxU6tZ";
                    var API_SECRET = "0CSTJZCXhE-gSZD_EWl8vDsCRsR1Nlny";
                    var imageURL = file.name;
                    console.log(typeof file.name);
                    console.log(imageURL);
                    $.ajax({
                        url: queryURL,
                        data: {
                            api_key: API_KEY,
                            api_secret: API_SECRET,
                            image_base64: imageURL,
                            return_attributes: "emotion"
                        },
                        method: "POST"
                    }).then(function (response) {
                        console.log(response);
                    })

                    reset();

                });
            });



            //$(".demo-frame").prepend(`<div class="welcome py-4">
            //  <h1 class="center-align">Welcome</h1>
            // </div>`);
            var timeSpace = $("<div class='timeSpace py-auto'>");
            var clockInMsg = $("<div>");
            var video = document.getElementById('video');
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            var name;
            var file;
            context.drawImage(video, 0, 0, 320, 240);


            var tracker = new tracking.ObjectTracker('face');
            tracker.setInitialScale(4);
            tracker.setStepSize(2);
            tracker.setEdgesDensity(0.1);

            tracking.track('#video', tracker, { camera: true });




            //tracker.on('track', function (event) {
            //context.clearRect(0, 0, canvas.width, canvas.height);

            // event.data.forEach(function (rect) {
            //  context.strokeStyle = '#a64ceb';
            //  context.strokeRect(rect.x, rect.y, rect.width, rect.height);
            //  context.font = '11px Helvetica';
            // context.fillStyle = "#fff";
            // context.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
            // context.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);

            // });




            //$(".demo-frame").html(`<div><h5>Time: ${timeStamp}</h5></div>`);



            //});

            //var gui = new dat.GUI();
            //gui.add(tracker, 'edgesDensity', 0.1, 0.5).step(0.01);
            //gui.add(tracker, 'initialScale', 1.0, 10.0).step(0.1);
            // gui.add(tracker, 'stepSize', 1, 5).step(0.1);
            function resetFunct() {
                display();
                clockInMsg.empty();
                timeSpace.detach();
            }

            function reset() {
                setTimeout(resetFunct, 5 * 1000);
            }


            //$("#demo-frame").html(`<div><h5>Time${timeStamp}</h5></div>');

        };


    </script>

</body>
<!-- jQUery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>


</html>